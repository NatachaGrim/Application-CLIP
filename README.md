# CLIP application

Redesign of the application developed by [ThorkildFregi](https://github.com/ThorkildFregi) and [Altomator](https://github.com/altomator).

**PLEASE NOTE**: the integration of a fine-tuning process is under development.

This application uses a CLIP (*Contrastive Language-Image Pre-training*) model to process images and query them in natural language, all *via* a web interface.

- [Download the application](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#download-the-application)
- [Data structure](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#data-structure)
  - [Files and folders required](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#files-and-folders-required)
  - [Data required](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#data-required)
  - [Generated files](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#generated-files)
- [Setting up the virtual environment](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#setting-up-the-virtual-environment)
  - [Installing Python](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-1-installing-python)
  - [Installing a virtual environment](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-2-installing-a-virtual-environment)
  - [Installing dependencies](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-3-installing-dependencies)
- [Launch](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#launch)
  - [Position yourself in the right folder](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-1-position-yourself-in-the-right-folder)
  - [Activate the virtual environment](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-2-activate-the-virtual-environment)
  - [Run the launcher](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-3-run-the-launcher)
  - [Quit the application](https://github.com/NatachaGrim/Application-CLIP/tree/main?tab=readme-ov-file#step-4-quit-the-application)

__________

## Download the application

At the top of the page is a green ```<> Code``` button. Click on it and select the ```Download ZIP``` option. Extract the files to the location of your choice on your computer.

## Data structure

To ensure all the steps are clear, let's review the structure of the working folder and its naming constraints. Other files will be generated as the scripts are run. Here is the initial structure:

```
ğŸ“ CLIP-app
 â”œâ”€â”€â”€ ğŸ“ app
 â”‚     â”œâ”€â”€â”€ app.py
 â”‚     â”œâ”€â”€â”€ config.py
 â”‚     â”œâ”€â”€â”€ ğŸ“ models
 â”‚     â”œâ”€â”€â”€ ğŸ“ routes
 â”‚     â”œâ”€â”€â”€ ğŸ“ scripts
 â”‚     â”œâ”€â”€â”€ ğŸ“ static
 â”‚     â”œâ”€â”€â”€ ğŸ“ templates
 â”‚     â””â”€â”€â”€ ğŸ“ utils
 â”œâ”€â”€â”€ ğŸ“ clip_env
 â”œâ”€â”€â”€ launch_PowerShell
 â”œâ”€â”€â”€ launch_Bash
 â”œâ”€â”€â”€ run.py
 â””â”€â”€â”€ requirements.txt
```

### Files and folders required

The ```ğŸ“ static``` folder contains subfolders, the contents of which we will not go into in detail. This is where you load your data. To do so, here's what you need to create in it:

```
ğŸ“ static
 â””â”€â”€â”€ ğŸ“ project_name
       â”œâ”€â”€â”€ ğŸ“ images
       â”‚     â”œâ”€â”€â”€ ğŸ“ subfoler_01
       â”‚     â”œâ”€â”€â”€ ğŸ“ subfolder_02
       â”‚     â””â”€â”€â”€ ğŸ“ subfolder_...
       â””â”€â”€â”€ ğŸ“ ontology
             â””â”€â”€â”€ project_name_ontology.txt
```

You can name the ```ğŸ“ project_name``` and every ```ğŸ“ subfolder``` folder as you wish (with no spaces or special characters). As a consequence, the ```project_name_ontology.txt``` file must be named after ```ğŸ“ project_name```. The ```ğŸ“ images``` and ```ğŸ“ ontology``` folders must keep these names:

```
ğŸ“ static
 â””â”€â”€â”€ ğŸ“ Royere
       â”œâ”€â”€â”€ ğŸ“ images
       â”‚     â”œâ”€â”€â”€ ğŸ“ petites_gouaches
       â”‚     â”œâ”€â”€â”€ ğŸ“ grandes_gouaches
       â”‚     â”œâ”€â”€â”€ ğŸ“ calques_vue_ensemble
       â”‚     â””â”€â”€â”€ ğŸ“ calques_execution
       â””â”€â”€â”€ ğŸ“ ontology
             â””â”€â”€â”€ Royere_ontology.txt
```

### Data required

The application needs two types of input data: images and text.
- Images in the ```ğŸ“ images``` folder;
- Textual data in the ```project_name_ontology.txt``` file.

This ```.txt``` file contains both the labels and the captions. It must be identical to the model shown below.

```
"Chaise": "siÃ¨ge Ã  dossier et gÃ©nÃ©ralement sans bras"
"Tapis": "panneau d'Ã©toffe, ouvrage que l'on pose sur un meuble, un mur ou un sol"
"Luminaire": "tout objet constituant l'Ã©clairage et la dÃ©coration lumineuse"
```

### Generated files

Three files will be generated by the scripts in the ```ğŸ“ project_name``` folder:

- ```project_name_ontology.csv```;
- ```project_name_list.txt```;
- ```project_name_directory.txt```.

The ```project_name_ontology.csv``` file is generated from the ```project_name_ontology.txt``` file and will be used to process queries submitted to the application.

The ```project_name_list.txt``` file lists the images in the ```ğŸ“ images``` folder with their path.

The ```project_name_directory.txt``` file is a summary of information about the ```ğŸ“ project_name``` folder: its relative path, its absolute path, its sub-folders and the total number of images found. In steps of 10, the path of an image is displayed.

Once the scripts have been run, the ```ğŸ“ project_name``` folder will look like this:

```
ğŸ“ static
 â””â”€â”€â”€ ğŸ“ project_name
       â”œâ”€â”€â”€ ğŸ“ images
       â”œâ”€â”€â”€ ğŸ“ ontology
       â”‚     â”œâ”€â”€â”€ project_name_ontology.txt
       â”‚     â””â”€â”€â”€ project_name_ontology.csv
       â”œâ”€â”€â”€ project_name_list.txt
       â””â”€â”€â”€ project_name_directory.txt
```

__________

## Setting up the virtual environment

At the root of the application is the ```ğŸ“ clip_env``` folder. This is the virtual environment you will need to create to run the application.

### Step 1: installing Python

[Python for Windows](https://www.python.org/downloads/)

[Python for Mac](https://www.python.org/downloads/macos/)

Python for Linux: 
```
sudo apt install python3
```

### Step 2: installing a virtual environment

Open your terminal and use the command ```cd folder_name``` to move around your computer and ```cd ..``` to go back one step. Locate yourself in the ```ğŸ“ CLIP-app``` folder and run the following command:

Windows:
```
python -m venv clip_env
```

Mac:
```
python3 -m venv clip_env
```

Linux: 
```
virtualenv clip_env -p python3
```

### Step 3: installing dependencies

Activate the virtual environment:

Windows: 
```
.\clip_env\Scripts\activate
```

Mac and Linux:
```
source clip_env/bin/activate
```

Install the dependencies indicated in the ```requirements.txt``` file:
```
pip install -r requirements.txt
```

Deactivate the virtual environment:
```
deactivate
```

You now have your virtual environment. You will need to activate it each time you launch the application, and deactivate it once you have finished your session.

__________

## Launch

Here are the steps to follow each time you want to launch the application. 

### Step 1: position yourself in the right folder

Locate yourself in the ```ğŸ“ CLIP-app``` folder.

### Step 2: activate the virtual environment

Windows: 
```
.\clip_env\Scripts\activate
```

Mac and Linux:
```
source clip_env/bin/activate
```

### Step 3: run the launcher

Windows:

```
.\launch_PowerShell.ps1
```

Mac and Linux:
```
bash launch_Bash.sh
```

You should see this interface:

![CLIP interface](README_images/clip_app_terminal.png)

Enter the name of your ```ğŸ“ project_name```. The application will launch in a window of your current browser. If you get a "connection failed" error message, refresh the page. The application may take more or less time to start up depending on the quality of your connection.

### Step 4: quit the application

Return to the terminal and simply press ```ctrl + c```.
